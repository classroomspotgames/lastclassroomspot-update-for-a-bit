<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CodeLearn - Student Portal</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="favicon.ico">
<style>
  :root {
    --primary: #667eea;
    --primary-hover: #5a67d8;
    --secondary: #764ba2;
    --bg-light: #f0f2f5;
    --text-dark: #1f2937;
    --glass-bg: rgba(255, 255, 255, 0.85);
    --glass-border: rgba(255, 255, 255, 0.3);
    --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    background: var(--bg-light);
    min-height: 100vh;
    overflow-x: hidden;
    color: var(--text-dark);
  }

  /* --- Login Screen --- */
  .login-screen {
    position: fixed;
    inset: 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    transition: opacity 0.5s ease;
  }

  .login-screen.hidden {
    opacity: 0;
    pointer-events: none;
  }

  .login-box {
    background: var(--glass-bg);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid var(--glass-border);
    padding: 40px;
    border-radius: 24px;
    box-shadow: var(--shadow);
    width: 90%;
    max-width: 400px;
    text-align: center;
    position: relative;
    animation: slideUp 0.6s ease-out;
  }

  @keyframes slideUp {
    from { transform: translateY(30px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  .login-banner {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    margin-bottom: 20px;
    object-fit: cover;
    border: 4px solid white;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  }

  .login-box h1 {
    color: var(--text-dark);
    margin-bottom: 10px;
    font-size: 28px;
  }

  .login-box p {
    color: #666;
    margin-bottom: 30px;
    font-size: 14px;
  }

  .login-input {
    width: 100%;
    padding: 15px 20px;
    margin-bottom: 15px;
    border: 2px solid #e0e0e0;
    border-radius: 12px;
    font-size: 16px;
    transition: all 0.3s;
    outline: none;
    background: rgba(255,255,255,0.9);
  }

  .login-input:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
  }

  .login-btn {
    width: 100%;
    padding: 15px;
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
  }

  .login-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
  }

  .error-msg {
    color: #e60012;
    margin-top: 15px;
    font-size: 14px;
    display: none;
    font-weight: 500;
  }

  /* More Info Section */
  .more-info-container {
    margin-top: 20px;
    position: relative;
  }

  .more-info-btn {
    background: transparent;
    border: 1px solid #ccc;
    color: #666;
    padding: 8px 16px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.3s;
  }

  .more-info-btn:hover {
    border-color: var(--primary);
    color: var(--primary);
  }

  .info-tooltip {
    position: absolute;
    bottom: 120%;
    left: 50%;
    transform: translateX(-50%) scale(0.9);
    background: #333;
    color: white;
    padding: 15px;
    border-radius: 12px;
    width: 90%;
    opacity: 0;
    pointer-events: none;
    transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    z-index: 10;
  }

  .info-tooltip.active {
    opacity: 1;
    transform: translateX(-50%) scale(1);
    bottom: 140%;
  }

  .info-tooltip::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    margin-left: -8px;
    border-width: 8px;
    border-style: solid;
    border-color: #333 transparent transparent transparent;
  }

  .info-tooltip p {
    margin: 5px 0;
    font-size: 13px;
    color: #fff;
  }
  .info-tooltip strong { color: #ffd700; }

  /* --- Intro Screen --- */
  .intro-screen {
    position: fixed;
    inset: 0;
    background: #000;
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    flex-direction: column;
  }
  .intro-screen.active { display: flex; }
  .intro-gif {
    max-width: 200px;
    border-radius: 20px;
    margin-bottom: 20px;
  }
  .intro-text {
    color: white;
    font-size: 20px;
    letter-spacing: 2px;
    animation: pulse 1.5s infinite;
  }
  @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

  /* --- Main Site --- */
  .main-site {
    display: none;
    min-height: 100vh;
    flex-direction: column;
    background: var(--bg-light);
    padding-bottom: 100px; /* Space for dock */
  }
  .main-site.active { display: flex; }

  /* Header */
  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 40px;
    background: white;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    z-index: 100;
    position: sticky;
    top: 0;
  }

  .logo-section {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .logo-banner {
    height: 40px;
    border-radius: 8px;
  }

  .site-title {
    color: #333;
    font-size: 22px;
    font-weight: 700;
  }

  .header-controls {
    display: flex;
    align-items: center;
    gap: 20px;
  }

  /* Search Bar */
  .search-container {
    position: relative;
  }
  .search-input {
    padding: 10px 15px 10px 35px;
    border: 1px solid #ddd;
    border-radius: 20px;
    width: 250px;
    font-size: 14px;
    outline: none;
    transition: all 0.3s;
  }
  .search-input:focus {
    width: 300px;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }
  .search-icon {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: #999;
    font-size: 14px;
  }

  .total-games {
    color: white;
    background: #e60012;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
  }

  .time-display {
    color: #666;
    font-size: 14px;
    font-weight: 500;
    font-family: monospace;
  }

  /* Games Grid - Continuous Scroll Layout */
  .games-container {
    flex: 1;
    padding: 40px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .games-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(170px, 1fr));
    gap: 25px;
    width: 100%;
    max-width: 1200px;
  }

  .game-card {
    width: 100%;
    aspect-ratio: 1;
    border-radius: 20px;
    overflow: hidden;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    background: white;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    border: 3px solid transparent;
    position: relative;
  }

  .game-card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    border-color: var(--primary);
  }

  .game-card.favorite { border-color: #ffd700; }
  
  .game-card img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s;
  }
  .game-card:hover img { transform: scale(1.1); }

  .game-card .star {
    position: absolute;
    top: 10px;
    left: 10px;
    color: #ffd700;
    font-size: 22px;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
    z-index: 2;
    cursor: pointer;
    transition: transform 0.2s;
  }
  .game-card .star:hover { transform: scale(1.2); }
  .game-card .star.empty { color: rgba(255,255,255,0.6); }

  .game-card .title {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 15px;
    background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, transparent 100%);
    color: white;
    font-size: 14px;
    font-weight: 600;
    text-align: center;
    opacity: 0;
    transition: opacity 0.3s;
  }
  .game-card:hover .title { opacity: 1; }

  /* My List Section */
  .my-list-section {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.9);
    background: white;
    padding: 30px;
    border-radius: 24px;
    box-shadow: 0 25px 80px rgba(0,0,0,0.2);
    z-index: 1002;
    max-width: 900px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    display: none;
    opacity: 0;
    transition: all 0.3s ease;
  }
  .my-list-section.active {
    display: block;
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
  .my-list-section h2 {
    color: #333;
    margin-bottom: 20px;
    font-size: 24px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .my-list-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 20px;
  }
  .close-mylist-btn {
    margin-top: 20px;
    padding: 12px;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    font-size: 16px;
    width: 100%;
    font-weight: 600;
    transition: background 0.2s;
  }
  .close-mylist-btn:hover { background: var(--primary-hover); }

  /* Dock */
  .dock-container {
    position: fixed;
    bottom: 25px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 15px;
    padding: 12px 20px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border-radius: 25px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    border: 1px solid rgba(255,255,255,0.5);
    z-index: 100;
  }
  .dock-item {
    width: 45px;
    height: 45px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
    background: #f5f5f5;
    border: 2px solid transparent;
    position: relative;
  }
  .dock-item:hover {
    transform: translateY(-5px);
    background: var(--primary);
    border-color: var(--primary);
  }
  .dock-item:hover svg { fill: white; }
  .dock-item svg {
    width: 22px;
    height: 22px;
    fill: #666;
    transition: fill 0.2s;
  }
  .dock-item.mylist-btn {
    background: linear-gradient(135deg, #ffd700 0%, #ffaa00 100%);
  }
  .dock-item.mylist-btn svg { fill: white; }
  .dock-item.settings-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }
  .dock-item.settings-btn svg { fill: white; }
  .dock-item .badge {
    position: absolute;
    top: -5px;
    right: -5px;
    background: #e60012;
    color: white;
    font-size: 11px;
    font-weight: bold;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Window styling */
  .window {
    position: fixed; 
    top: 50%; 
    left: 50%; 
    transform: translate(-50%, -50%) scale(0.95);
    width: 85%; 
    height: 85%; 
    background: white; 
    border-radius: 20px;
    box-shadow: 0 25px 80px rgba(0,0,0,0.3); 
    z-index: 1000;
    display: flex; 
    flex-direction: column; 
    overflow: hidden;
    border: 1px solid #eee;
    opacity: 0;
    pointer-events: none;
    transition: all 0.3s ease;
  }
  .window.active { 
    opacity: 1; 
    pointer-events: all;
    transform: translate(-50%, -50%) scale(1);
  }
  .topbar {
    display: flex; 
    justify-content: space-between; 
    align-items: center;
    padding: 12px 20px; 
    background: #f8f9fa; 
    border-bottom: 1px solid #eee;
  }
  .topbar span { 
    color: #333; 
    font-weight: 600;
    font-size: 16px;
  }
  .topbar button { 
    background: #e0e0e0; 
    border: none; 
    color: #333; 
    width: 30px;
    height: 30px;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
  }
  .topbar button:hover { 
    background: #e60012;
    color: white; 
  }
  #frame { 
    flex: 1; 
    width: 100%; 
    border: none; 
    background: white; 
  }

  /* Settings panel */
  .settings {
    position: fixed; 
    top: 50%; 
    left: 50%; 
    transform: translate(-50%, -50%) scale(0.95);
    background: white; 
    padding: 30px; 
    border-radius: 24px;
    box-shadow: 0 25px 80px rgba(0,0,0,0.2); 
    z-index: 1001;
    max-width: 500px; 
    width: 90%;
    border: 1px solid #eee;
    max-height: 80vh;
    overflow-y: auto;
    opacity: 0;
    pointer-events: none;
    transition: all 0.3s ease;
  }
  .settings.active { 
    opacity: 1; 
    pointer-events: all;
    transform: translate(-50%, -50%) scale(1);
  }
  .settings h3 { 
    color: #333; 
    margin-top: 24px; 
    margin-bottom: 16px; 
    font-size: 18px;
    font-weight: 600;
    padding-bottom: 8px;
    border-bottom: 2px solid var(--primary);
  }
  .settings h3:first-child { margin-top: 0; }
  .settings button {
    margin: 6px; 
    padding: 10px 16px; 
    background: #f0f0f0;
    border: 1px solid #ddd; 
    border-radius: 12px;
    color: #333; 
    cursor: pointer; 
    font-size: 13px; 
    transition: all 0.2s;
  }
  .settings button:hover { 
    background: var(--primary); 
    color: white;
    transform: translateY(-1px);
    border-color: transparent;
  }
  .settings input {
    width: 100%;
    padding: 12px;
    margin: 8px 0;
    background: #f5f5f5;
    border: 1px solid #ddd;
    border-radius: 12px;
    color: #333;
    font-size: 14px;
  }
  .settings input::placeholder { color: #999; }

  /* Visitor Counter */
  .visitor-counter {
    position: fixed;
    bottom: 100px;
    right: 20px;
    background: white;
    padding: 10px 20px;
    border-radius: 30px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    font-size: 14px;
    color: #666;
    z-index: 50;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .visitor-counter span {
    color: var(--primary);
    font-weight: bold;
    font-size: 16px;
  }

  /* Overlay */
  .overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.5);
    z-index: 999;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
  }
  .overlay.active {
    opacity: 1;
    pointer-events: all;
  }

  /* No games message */
  .no-games {
    text-align: center;
    color: #666;
    padding: 40px;
    font-size: 16px;
    grid-column: 1 / -1;
  }
</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div class="login-screen" id="loginScreen">
  <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSEtseCaQReYgXH1C-tdRM6kNttqlXvFyym_g&s" alt="CodeLearn" class="login-banner">
  <div class="login-box">
    <h1>üîí Student Login</h1>
    <p>Welcome to CodeLearn Programming Portal</p>
    <input type="text" class="login-input" id="username" placeholder="Username" autocomplete="off">
    <input type="password" class="login-input" id="password" placeholder="Password">
    <button class="login-btn" onclick="checkLogin()">Sign In</button>
    <div class="error-msg" id="errorMsg">Invalid username or password!</div>
    
    <!-- More Info Section -->
    <div class="more-info-container">
      <button class="more-info-btn" onclick="toggleInfo()">‚ÑπÔ∏è More Info</button>
      <div class="info-tooltip" id="infoTooltip">
        <p><strong>Username:</strong> 1</p>
        <p><strong>Password:</strong> blockmelol</p>
      </div>
    </div>
  </div>
</div>

<!-- INTRO SCREEN -->
<div class="intro-screen" id="introScreen">
  <img src="https://68.media.tumblr.com/ecea9391e51144ebfb48c0451f11ee70/tumblr_oh98s6US8x1qjoleso1_500.gif" alt="Loading" class="intro-gif">
  <div class="intro-text">Loading your workspace...</div>
</div>

<!-- MAIN SITE -->
<div class="main-site" id="mainSite">
  <div class="header">
    <div class="logo-section">
      <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSEtseCaQReYgXH1C-tdRM6kNttqlXvFyym_g&s" alt="CodeLearn" class="logo-banner">
      <span class="site-title">CodeLearn</span>
    </div>
    <div class="header-controls">
      <!-- Search Bar -->
      <div class="search-container">
        <span class="search-icon">üîç</span>
        <input type="text" class="search-input" id="searchInput" placeholder="Search games..." oninput="handleSearch()">
      </div>
      <span class="total-games" id="totalGames">Total Games: Loading...</span>
      <span class="time-display" id="clock">12:00 PM</span>
    </div>
  </div>

  <!-- Games Grid - Continuous Scroll -->
  <div class="games-container">
    <div class="games-grid" id="gamesGrid">
      <!-- Games loaded here -->
    </div>
  </div>
</div>

<!-- Visitor Counter -->
<div class="visitor-counter" id="visitorCounter">
  üë• Visitors: <span id="visitorCount">1257</span>
</div>

<!-- My List Section -->
<div class="my-list-section" id="myListSection">
  <h2>‚≠ê My List (<span id="myListCount">0</span>)</h2>
  <div class="my-list-grid" id="myListGrid"></div>
  <button class="close-mylist-btn" onclick="closeMyList()">Close</button>
</div>

<!-- Overlay for modals -->
<div class="overlay" id="overlay" onclick="closeAllModals()"></div>

<!-- Dock -->
<div class="dock-container">
  <div class="dock-item" onclick="openWindow('movies.html','Movies')" title="Movies">
    <svg viewBox="0 0 24 24"><path d="M18 3v2h-2V3H8v2H6V3H4v18h2v-2h2v2h8v-2h2v2h2V3h-2zM8 17H6v-2h2v2zm0-4H6v-2h2v2zm0-4H6V7h2v2zm10 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V7h2v2z"/></svg>
  </div>
  <div class="dock-item" onclick="openWindow('partners.html','Partners')" title="Partners">
    <svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
  </div>
  <div class="dock-item" onclick="openWindow('unblockers.html','Unblocker')" title="Unblocker">
    <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
  </div>
  <div class="dock-item mylist-btn" onclick="openMyList()" title="My List">
    <svg viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
    <span class="badge" id="myListBadge" style="display: none;">0</span>
  </div>
  <div class="dock-item settings-btn" onclick="openSettings()" title="Settings">
    <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L5.09 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
  </div>
</div>

<div id="window" class="window">
  <div class="topbar">
    <span id="windowTitle">App</span>
    <button onclick="closeWindow()">‚úï</button>
  </div>
  <iframe id="frame"></iframe>
</div>

<div id="settings" class="settings">
  <h3>üé® Wallpapers</h3>
  <button onclick="setWallpaper('goku')">Goku</button>
  <button onclick="setWallpaper('goku2')">Goku 2</button>
  <button onclick="setWallpaper('naruto')">Naruto</button>
  <button onclick="setWallpaper('surfer')">Silver Surfer</button>
  <button onclick="setWallpaper('surfer-gif')">Silver Surfer GIF</button>
  <button onclick="setWallpaper('surfer2')">Silver Surfer 2</button>
  <button onclick="setWallpaper('naruto-gif')">Naruto GIF</button>
  <button onclick="setWallpaper('onepiece')">One Piece</button>
  <button onclick="setWallpaper('jjk')">JJK</button>
  <button onclick="setWallpaper('roblox')">Roblox</button>
  <button onclick="setWallpaper('fortnite')">Fortnite</button>
  <button onclick="setWallpaper('dbz')">Dragon Ball Z</button>
  <button onclick="setWallpaper('tungtung')">Tung Tung Sahur</button>

  <h3>üé≠ Cloak</h3>
  <button onclick="openAboutBlank()">Open about:blank</button>
  <input id="cloakInput" placeholder="Tab name">
  <button onclick="setCloak()">Apply Cloak</button>
  <br><br>
  <button onclick="closeSettings()">Close Settings</button>
</div>

<script>
const wallpapers = {
  'goku': 'https://wallpaperaccess.com/full/9802.jpg',
  'goku2': 'https://th.bing.com/th/id/R.45275f2e1774c1d0b1a9d1a2994e32ec?rik=X4g7q68hTKZNUA&riu=http%3a%2f%2fwallpapercave.com%2fwp%2fWhqqjsD.jpg&ehk=AY5R2%2bOgfgD2Uof%2f783mSiAXbuQgeWiZfYJuR31vKw%3d&risl=&pid=ImgRaw&r=0',
  'naruto': 'https://tse1.mm.bing.net/th/id/OIP.S47sN1EnbmRlDgTD3coBiwHaDs?rs=1&pid=ImgDetMain&o=7&rm=3',
  'surfer': 'https://th.bing.com/th/id/OIP.ApR_wuPX0MsWpSWi73xMpgHaEK?o=7rm=3&rs=1&pid=ImgDetMain&o=7&rm=3',
  'surfer-gif': 'https://media.tenor.com/j1QA4Dpg4SIAAAAM/silver.gif',
  'surfer2': 'https://tse2.mm.bing.net/th/id/OIP.GYQW-TNWUuPL_tnhGv9D2QHaEK?rs=1&pid=ImgDetMain&o=7&rm=3',
  'naruto-gif': 'https://th.bing.com/th/id/R.e032973a23b3df2cfb20cf8c040545d0?rik=bjH3YH1rUQUXaA&riu=http%3a%2f%2forig02.deviantart.net%2f386f%2ff%2f2015%2f063%2f3%2f6%2fnaruto_attack_____by_hayabusasnake-d8kemfl.gif&ehk=oF%2fkeZtiHzVnJrcSvfsb6jE6i%2bA8vEQO1ypp3rsU6iE%3d&risl=&pid=ImgRaw&r=0',
  'onepiece': 'https://i.pinimg.com/originals/16/48/1e/16481e1d0b4a20444b94569128d34d30.jpg',
  'jjk': 'https://wallpapercave.com/wp/wp9745449.png',
  'roblox': 'https://wallpaperaccess.com/full/196936.jpg',
  'fortnite': 'https://wallpapercave.com/wp/wp5278223.jpg',
  'dbz': 'https://wallpapercave.com/wp/wp8939942.jpg',
  'tungtung': 'https://tse3.mm.bing.net/th/id/OIP.Gs7yG0bYERnVM_sCK4kIpAHaEK?rs=1&pid=ImgDetMain&o=7&rm=3'
};

// Clock
function updateClock() {
  const now = new Date();
  const timeString = now.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
  document.getElementById('clock').textContent = timeString;
}
setInterval(updateClock, 1000);
updateClock();

// Visitor Counter - Starts at 1257
function updateVisitorCounter() {
  let count = localStorage.getItem('visitorCount');
  if (!count) {
    count = 1256; 
  }
  count = parseInt(count) + 1;
  localStorage.setItem('visitorCount', count);
  document.getElementById('visitorCount').textContent = count.toLocaleString();
}
updateVisitorCounter();

// More Info Toggle
function toggleInfo() {
  const tooltip = document.getElementById('infoTooltip');
  tooltip.classList.toggle('active');
}

// Favorites System
let favorites = JSON.parse(localStorage.getItem('codeLearnFavorites')) || [];

function toggleFavorite(gameName, event) {
  event.stopPropagation();
  const index = favorites.indexOf(gameName);
  if (index > -1) {
    favorites.splice(index, 1);
  } else {
    favorites.push(gameName);
  }
  localStorage.setItem('codeLearnFavorites', JSON.stringify(favorites));
  updateMyListBadge();
  renderGames();
}

function isFavorite(gameName) {
  return favorites.includes(gameName);
}

function updateMyListBadge() {
  const badge = document.getElementById('myListBadge');
  badge.textContent = favorites.length;
  badge.style.display = favorites.length > 0 ? 'flex' : 'none';
  document.getElementById('myListCount').textContent = favorites.length;
}

// Login System
function checkLogin() {
  const username = document.getElementById('username').value;
  const password = document.getElementById('password').value;
  const errorMsg = document.getElementById('errorMsg');
  
  if (username === '1' && password === 'blockmelol') {
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('introScreen').classList.add('active');
    
    setTimeout(() => {
      document.getElementById('introScreen').classList.remove('active');
      document.getElementById('mainSite').classList.add('active');
      loadGames();
      updateMyListBadge();
    }, 3000);
  } else {
    errorMsg.style.display = 'block';
    setTimeout(() => {
      errorMsg.style.display = 'none';
    }, 3000);
  }
}

// Allow Enter key to login
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('password').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') checkLogin();
  });
  document.getElementById('username').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') document.getElementById('password').focus();
  });
});

// My List Functions
function openMyList() {
  const section = document.getElementById('myListSection');
  const grid = document.getElementById('myListGrid');
  const overlay = document.getElementById('overlay');
  
  grid.innerHTML = '';
  
  const favGames = allGames.filter(g => favorites.includes(g.name));
  
  if (favGames.length === 0) {
    grid.innerHTML = '<p style="color: #666; text-align: center; grid-column: 1/-1;">No favorites yet! Click the ‚≠ê on games to add them.</p>';
  } else {
    favGames.forEach(game => {
      const card = createGameCard(game, true);
      grid.appendChild(card);
    });
  }
  
  section.classList.add('active');
  overlay.classList.add('active');
}

function closeMyList() {
  document.getElementById('myListSection').classList.remove('active');
  document.getElementById('overlay').classList.remove('active');
}

// Games Data
let allGames = [];
let filteredGames = [];

const ZONES = "https://cdn.jsdelivr.net/gh/gn-math/assets@main/zones.json";
const COVER = "https://cdn.jsdelivr.net/gh/gn-math/covers@main/";
const HTML_URL = "https://cdn.jsdelivr.net/gh/gn-math/html@main/";

const ROBLOX_IMAGE = "https://tse3.mm.bing.net/th/id/OIP.Suu0wkaP6duvpXY_gWJucgAAAA?rs=1&pid=ImgDetMain&o=7&rm=3";
const GTA_IMAGE = "https://tse2.mm.bing.net/th/id/OIP.T6kQS4BQ4CCT6jlXGtAuDgHaE7?rs=1&pid=ImgDetMain&o=7&rm=3";

function getRobloxHTML() {
  return `<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>roblox - Truffled</title>
<style>
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background: #000;
}
iframe {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    border: none;
}
#truffled-logo {
    position: fixed;
    bottom: 10px;
    right: 10px;
    width: 150px;
    height: 150px;
    cursor: pointer;
    z-index: 9999;
}
</style>
</head>
<body>
<iframe src="https://nevertraveling.thepresenttraveller.com/gamefile/nowgg/roblox.html?prefix=149" allowfullscreen></iframe>
<a href="https://nevertraveling.thepresenttraveller.com" target="_blank">
    <img id="truffled-logo" src="https://nevertraveling.thepresenttraveller.com/png/logo.png" alt="Logo">
</a>
</body>
</html>`;
}

function createGameCard(game, isMyList = false) {
  const card = document.createElement("div");
  card.className = "game-card";
  if (isFavorite(game.name)) {
    card.classList.add('favorite');
  }
  
  if (game.cover) {
    const img = document.createElement("img");
    img.src = game.cover;
    img.alt = game.name;
    img.loading = "lazy";
    card.appendChild(img);
  }
  
  // Favorite star button
  const star = document.createElement("span");
  star.className = "star" + (isFavorite(game.name) ? "" : " empty");
  star.innerHTML = isFavorite(game.name) ? "‚òÖ" : "‚òÜ";
  star.onclick = (e) => toggleFavorite(game.name, e);
  card.appendChild(star);
  
  const title = document.createElement("div");
  title.className = "title";
  title.textContent = game.name;
  card.appendChild(title);
  
  card.onclick = () => {
    openGame(game);
  };
  
  return card;
}

function loadGames() {
  fetch(ZONES + "?t=" + Date.now())
    .then(r => {
      if (!r.ok) throw new Error("HTTP " + r.status);
      return r.json();
    })
    .then(data => {
      const apiGames = data.filter(g => !g.name.toLowerCase().includes("suggest") && !g.name.includes("[!]")).map(g => ({
        name: g.name,
        cover: g.cover ? g.cover.replace("{COVER_URL}", COVER).replace("{HTML_URL}", HTML_URL) : '',
        url: g.url,
        star: false
      }));
      
      allGames = [
        { name: "Roblox", cover: ROBLOX_IMAGE, html: getRobloxHTML(), star: true },
        { name: "GTA Vice City", cover: GTA_IMAGE, url: "https://sites.google.com/view/gtavicecityforclassroomspot/sdds?authuser=1", external: true, star: false },
        ...apiGames
      ];
      
      filteredGames = [...allGames];
      
      document.getElementById('totalGames').textContent = `Total Games: ${allGames.length}`;
      renderGames();
    })
    .catch(err => {
      console.error("Error loading games:", err);
      allGames = [
        { name: "Roblox", cover: ROBLOX_IMAGE, html: getRobloxHTML(), star: true },
        { name: "GTA Vice City", cover: GTA_IMAGE, url: "https://sites.google.com/view/gtavicecityforclassroomspot/sdds?authuser=1", external: true, star: false }
      ];
      filteredGames = [...allGames];
      document.getElementById('totalGames').textContent = `Total Games: ${allGames.length}`;
      renderGames();
    });
}

// Search Functionality
function handleSearch() {
  const query = document.getElementById('searchInput').value.toLowerCase();
  if (query === '') {
    filteredGames = [...allGames];
  } else {
    filteredGames = allGames.filter(game => game.name.toLowerCase().includes(query));
  }
  renderGames();
}

function renderGames() {
  const grid = document.getElementById('gamesGrid');
  grid.innerHTML = '';
  
  if (filteredGames.length === 0) {
    grid.innerHTML = '<div class="no-games">No games found matching your search.</div>';
    return;
  }
  
  filteredGames.forEach((game) => {
    const card = createGameCard(game);
    grid.appendChild(card);
  });
}

// Window Functions
function openWindow(url, title) {
  const win = document.getElementById('window');
  const frame = document.getElementById('frame');
  const titleSpan = document.getElementById('windowTitle');
  const overlay = document.getElementById('overlay');
  
  frame.src = url; 
  titleSpan.textContent = title; 
  win.classList.add('active');
  overlay.classList.add('active');
}

function closeWindow() {
  const win = document.getElementById('window');
  const frame = document.getElementById('frame');
  const overlay = document.getElementById('overlay');
  
  win.classList.remove('active');
  overlay.classList.remove('active');
  setTimeout(() => {
    frame.src = ''; 
  }, 300);
}

function closeAllModals() {
  closeWindow();
  closeSettings();
  closeMyList();
}

function openGame(game) {
  if (game.external) {
    window.open(game.url, '_blank');
  } else if (game.html) {
    const win = window.open("about:blank", "_blank");
    win.document.open();
    win.document.write(game.html);
    win.document.close();
  } else if (game.url) {
    fetch(game.url.replace("{HTML_URL}", HTML_URL))
      .then(r => r.text())
      .then(t => {
        const win = window.open("about:blank", "_blank");
        win.document.open();
        win.document.write(t);
        win.document.close();
      })
      .catch(err => {
        alert('Error loading game');
      });
  }
}

// Settings
function openSettings() { 
  document.getElementById('settings').classList.add('active'); 
  document.getElementById('overlay').classList.add('active');
}

function closeSettings() { 
  document.getElementById('settings').classList.remove('active'); 
  document.getElementById('overlay').classList.remove('active');
}

function setWallpaper(name) {
  const url = wallpapers[name];
  if (url) {
    document.body.style.backgroundImage = `url('${url}')`;
    document.body.style.backgroundSize = 'cover';
    document.body.style.backgroundPosition = 'center';
    document.body.style.backgroundRepeat = 'no-repeat';
    document.body.style.backgroundAttachment = 'fixed';
    localStorage.setItem('selectedWallpaper', name);
  }
}

function openAboutBlank() {
  const win = window.open('about:blank', '_blank');
  if (win) {
    win.document.write(`<!DOCTYPE html><html><head><title>about:blank</title><style>body{margin:0;padding:0;background:#000;overflow:hidden;}#cloak-frame{position:fixed;top:0;left:0;width:100vw;height:100vh;border:none;}</style></head><body><iframe id="cloak-frame" src="${window.location.href}"></iframe><script>setInterval(function(){window.history.replaceState({},'about:blank','about:blank');},100);<\/script></body></html>`);
    win.document.close();
  }
}

function setCloak() {
  const name = document.getElementById('cloakInput').value || 'about:blank';
  document.title = name;
  const link = document.querySelector("link[rel*='icon']") || document.createElement('link');
  link.type = 'image/x-icon'; 
  link.rel = 'shortcut icon'; 
  link.href = 'data:image/x-icon;base64,';
  document.getElementsByTagName('head')[0].appendChild(link);
  history.pushState({}, name, 'about:blank');
}

// Initialize wallpaper
document.addEventListener('DOMContentLoaded', () => {
  const savedWallpaper = localStorage.getItem('selectedWallpaper');
  if (savedWallpaper && wallpapers[savedWallpaper]) {
    setWallpaper(savedWallpaper);
  }
});
</script>

</body>
</html>
