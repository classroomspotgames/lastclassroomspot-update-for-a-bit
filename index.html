<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Student Portal</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="favicon.ico">
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  background: #1a1a1a;
  min-height: 100vh;
  overflow: hidden;
  position: relative;
}

/* Login Screen */
.login-screen {
  position: fixed;
  inset: 0;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  transition: opacity 0.5s;
}

.login-screen.hidden {
  opacity: 0;
  pointer-events: none;
}

.login-banner {
  width: 300px;
  height: auto;
  margin-bottom: 40px;
  border-radius: 20px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
}

.login-box {
  background: rgba(255,255,255,0.95);
  padding: 40px;
  border-radius: 24px;
  box-shadow: 0 25px 80px rgba(0,0,0,0.3);
  width: 90%;
  max-width: 400px;
  text-align: center;
}

.login-box h1 {
  color: #333;
  margin-bottom: 10px;
  font-size: 28px;
}

.login-box p {
  color: #666;
  margin-bottom: 30px;
  font-size: 14px;
}

.login-input {
  width: 100%;
  padding: 15px 20px;
  margin-bottom: 15px;
  border: 2px solid #e0e0e0;
  border-radius: 12px;
  font-size: 16px;
  transition: all 0.3s;
  outline: none;
}

.login-input:focus {
  border-color: #667eea;
}

.login-btn {
  width: 100%;
  padding: 15px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: transform 0.2s;
}

.login-btn:hover {
  transform: translateY(-2px);
}

.error-msg {
  color: #e60012;
  margin-top: 15px;
  font-size: 14px;
  display: none;
}

/* Intro Screen */
.intro-screen {
  position: fixed;
  inset: 0;
  background: #000;
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  flex-direction: column;
}

.intro-screen.active {
  display: flex;
}

.intro-gif {
  max-width: 80%;
  max-height: 60vh;
  border-radius: 20px;
}

.intro-text {
  color: white;
  margin-top: 30px;
  font-size: 24px;
  animation: pulse 1.5s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

/* Main Site */
.main-site {
  display: none;
  height: 100vh;
  flex-direction: column;
}

.main-site.active {
  display: flex;
}

/* Dynamic Wallpaper Background */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  z-index: -2;
  transition: background-image 0.5s ease;
}

body::after {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(to bottom, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.4) 100%);
  z-index: -1;
  pointer-events: none;
}

/* Header */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 40px;
  background: rgba(0,0,0,0.3);
  backdrop-filter: blur(10px);
}

.logo-section {
  display: flex;
  align-items: center;
  gap: 15px;
}

.logo-banner {
  height: 50px;
  border-radius: 10px;
}

.total-games {
  color: white;
  background: rgba(230, 0, 18, 0.8);
  padding: 8px 16px;
  border-radius: 20px;
  font-size: 14px;
  font-weight: 600;
}

.time-display {
  color: white;
  font-size: 16px;
  font-weight: 500;
}

/* Games Carousel Container */
.games-carousel-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  position: relative;
  padding: 20px;
}

.games-wrapper {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 20px;
  width: 100%;
  max-width: 1200px;
}

/* Navigation Arrows */
.nav-arrow {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: rgba(255,255,255,0.15);
  border: 2px solid rgba(255,255,255,0.3);
  color: white;
  font-size: 24px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
  backdrop-filter: blur(10px);
  flex-shrink: 0;
}

.nav-arrow:hover {
  background: rgba(230, 0, 18, 0.8);
  border-color: #e60012;
  transform: scale(1.1);
}

.nav-arrow:disabled {
  opacity: 0.3;
  cursor: not-allowed;
}

/* Games Row - Exactly 5 games like Switch */
.games-row {
  display: flex;
  gap: 20px;
  justify-content: center;
  flex: 1;
}

.game-card {
  width: 160px;
  height: 160px;
  border-radius: 16px;
  overflow: hidden;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 32px rgba(0,0,0,0.4);
  background: rgba(255,255,255,0.1);
  backdrop-filter: blur(10px);
  border: 3px solid transparent;
  position: relative;
  flex-shrink: 0;
}

.game-card:hover, .game-card.focused {
  transform: translateY(-10px) scale(1.05);
  box-shadow: 0 20px 60px rgba(0,0,0,0.5);
  border-color: #e60012;
}

.game-card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s;
}

.game-card:hover img, .game-card.focused img {
  transform: scale(1.1);
}

.game-card .star {
  position: absolute;
  top: 8px;
  left: 8px;
  color: #ffd700;
  font-size: 20px;
  filter: drop-shadow(0 2px 4px rgba(0,0,0,0.8));
  z-index: 2;
}

.game-card .title {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 12px;
  background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, transparent 100%);
  color: white;
  font-size: 12px;
  font-weight: 600;
  text-align: center;
  opacity: 0;
  transition: opacity 0.3s;
}

.game-card:hover .title, .game-card.focused .title {
  opacity: 1;
}

/* Page Indicator */
.page-indicator {
  display: flex;
  gap: 8px;
  margin-top: 30px;
  justify-content: center;
}

.page-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: rgba(255,255,255,0.3);
  transition: all 0.3s;
  cursor: pointer;
}

.page-dot.active {
  background: #e60012;
  width: 30px;
  border-radius: 5px;
}

/* Nintendo Switch Style Dock */
.dock-container {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 12px;
  padding: 12px 20px;
  background: rgba(30, 30, 30, 0.95);
  border-radius: 20px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.5);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255,255,255,0.1);
  z-index: 100;
}

.dock-item {
  width: 48px;
  height: 48px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s;
  background: rgba(255,255,255,0.1);
  border: 2px solid transparent;
}

.dock-item:hover {
  transform: translateY(-6px);
  background: rgba(255,255,255,0.2);
}

.dock-item svg {
  width: 24px;
  height: 24px;
  fill: white;
}

.dock-item.settings-btn {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

/* Window styling */
.window {
  position: fixed; 
  top: 50%; 
  left: 50%; 
  transform: translate(-50%, -50%);
  width: 85%; 
  height: 85%; 
  background: #1a1a1a; 
  border-radius: 20px;
  box-shadow: 0 25px 80px rgba(0,0,0,0.8); 
  z-index: 1000;
  display: flex; 
  flex-direction: column; 
  overflow: hidden;
  border: 1px solid rgba(255,255,255,0.1);
}
.window.hidden { display: none; }
.topbar {
  display: flex; 
  justify-content: space-between; 
  align-items: center;
  padding: 16px 20px; 
  background: rgba(255,255,255,0.05); 
  border-bottom: 1px solid rgba(255,255,255,0.1);
}
.topbar span { 
  color: white; 
  font-weight: 600;
  font-size: 16px;
}
.topbar button { 
  background: rgba(255,255,255,0.1); 
  border: none; 
  color: white; 
  width: 32px;
  height: 32px;
  border-radius: 8px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}
.topbar button:hover { 
  background: #e60012; 
}
#frame { 
  flex: 1; 
  width: 100%; 
  border: none; 
  background: white; 
}

/* Settings panel */
.settings {
  position: fixed; 
  top: 50%; 
  left: 50%; 
  transform: translate(-50%, -50%);
  background: rgba(30, 30, 30, 0.98); 
  padding: 32px; 
  border-radius: 24px;
  box-shadow: 0 25px 80px rgba(0,0,0,0.8); 
  z-index: 1001;
  max-width: 500px; 
  width: 90%;
  border: 1px solid rgba(255,255,255,0.1);
  max-height: 80vh;
  overflow-y: auto;
}
.settings.hidden { display: none; }

.settings h3 { 
  color: white; 
  margin-top: 24px; 
  margin-bottom: 16px; 
  font-size: 18px;
  font-weight: 600;
  padding-bottom: 8px;
  border-bottom: 2px solid #e60012;
}

.settings h3:first-child {
  margin-top: 0;
}

.settings button {
  margin: 6px; 
  padding: 10px 16px; 
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.1); 
  border-radius: 12px;
  color: white; 
  cursor: pointer; 
  font-size: 13px; 
  transition: all 0.2s;
}
.settings button:hover { 
  background: #e60012; 
  transform: translateY(-1px);
  border-color: transparent;
}

/* Keyboard hint */
.keyboard-hint {
  position: fixed;
  bottom: 100px;
  left: 50%;
  transform: translateX(-50%);
  color: rgba(255,255,255,0.6);
  font-size: 13px;
  background: rgba(0,0,0,0.5);
  padding: 8px 16px;
  border-radius: 20px;
  backdrop-filter: blur(10px);
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.3s;
}

.keyboard-hint.show {
  opacity: 1;
}
</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div class="login-screen" id="loginScreen">
  <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSEtseCaQReYgXH1C-tdRM6kNttqlXvFyym_g&s" alt="Portal" class="login-banner">
  <div class="login-box">
    <h1>ðŸ”’ Student Login</h1>
    <p>Welcome to the Programming Portal</p>
    <input type="text" class="login-input" id="username" placeholder="Username" autocomplete="off">
    <input type="password" class="login-input" id="password" placeholder="Password">
    <button class="login-btn" onclick="checkLogin()">Sign In</button>
    <div class="error-msg" id="errorMsg">Invalid username or password!</div>
  </div>
</div>

<!-- INTRO SCREEN -->
<div class="intro-screen" id="introScreen">
  <img src="https://68.media.tumblr.com/ecea9391e51144ebfb48c0451f11ee70/tumblr_oh98s6US8x1qjoleso1_500.gif" alt="Loading" class="intro-gif">
  <div class="intro-text">Loading your workspace...</div>
</div>

<!-- MAIN SITE -->
<div class="main-site" id="mainSite">
  <div class="header">
    <div class="logo-section">
      <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSEtseCaQReYgXH1C-tdRM6kNttqlXvFyym_g&s" alt="Portal" class="logo-banner">
    </div>
    <div style="display: flex; align-items: center; gap: 20px;">
      <span class="total-games" id="totalGames">Total Games: Loading...</span>
      <span class="time-display" id="clock">12:00 PM</span>
    </div>
  </div>

  <!-- Games Carousel -->
  <div class="games-carousel-container">
    <div class="games-wrapper">
      <button class="nav-arrow" id="prevBtn" onclick="prevPage()">â—€</button>
      <div class="games-row" id="gamesRow">
        <!-- Games loaded here -->
      </div>
      <button class="nav-arrow" id="nextBtn" onclick="nextPage()">â–¶</button>
    </div>
    <div class="page-indicator" id="pageIndicator"></div>
  </div>
</div>

<!-- Keyboard Navigation Hint -->
<div class="keyboard-hint" id="keyboardHint">Use A / D or â—€ / â–¶ to navigate</div>

<!-- Dock -->
<div class="dock-container">
  <div class="dock-item" onclick="openWindow('movies.html','Movies')" title="Movies">
    <svg viewBox="0 0 24 24"><path d="M18 3v2h-2V3H8v2H6V3H4v18h2v-2h2v2h8v-2h2v2h2V3h-2zM8 17H6v-2h2v2zm0-4H6v-2h2v2zm0-4H6V7h2v2zm10 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V7h2v2z"/></svg>
  </div>
  <div class="dock-item" onclick="openWindow('partners.html','Partners')" title="Partners">
    <svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
  </div>
  <div class="dock-item" onclick="openWindow('unblockers.html','Unblocker')" title="Unblocker">
    <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
  </div>
  <div class="dock-item settings-btn" onclick="openSettings()" title="Settings">
    <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L5.09 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
  </div>
</div>

<div id="window" class="window hidden">
  <div class="topbar">
    <span id="windowTitle">App</span>
    <button onclick="closeWindow()">âœ•</button>
  </div>
  <iframe id="frame"></iframe>
</div>

<div id="settings" class="settings hidden">
  <h3>ðŸŽ¨ Wallpapers</h3>
  <button onclick="setWallpaper('goku')">Goku</button>
  <button onclick="setWallpaper('goku2')">Goku 2</button>
  <button onclick="setWallpaper('naruto')">Naruto</button>
  <button onclick="setWallpaper('surfer')">Silver Surfer</button>
  <button onclick="setWallpaper('surfer-gif')">Silver Surfer GIF</button>
  <button onclick="setWallpaper('surfer2')">Silver Surfer 2</button>
  <button onclick="setWallpaper('naruto-gif')">Naruto GIF</button>
  <button onclick="setWallpaper('onepiece')">One Piece</button>
  <button onclick="setWallpaper('jjk')">JJK</button>
  <button onclick="setWallpaper('roblox')">Roblox</button>
  <button onclick="setWallpaper('fortnite')">Fortnite</button>
  <button onclick="setWallpaper('dbz')">Dragon Ball Z</button>
  <button onclick="setWallpaper('tungtung')">Tung Tung Sahur</button>

  <h3>ðŸŽ­ Cloak</h3>
  <button onclick="openAboutBlank()">Open about:blank</button>
  <input id="cloakInput" placeholder="Tab name" style="width: 100%; padding: 10px; margin: 8px 0; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
  <button onclick="setCloak()">Apply Cloak</button>
  <br><br>
  <button onclick="closeSettings()">Close Settings</button>
</div>

<script>
const wallpapers = {
  'goku': 'https://wallpaperaccess.com/full/9802.jpg',
  'goku2': 'https://th.bing.com/th/id/R.45275f2e1774c1d0b1a9d1a2994e32ec?rik=X4g7q68hTKZNUA&riu=http%3a%2f%2fwallpapercave.com%2fwp%2fWhqqjsD.jpg&ehk=AY5R2%2bOgfgD2Uof%2f783mSiAXbuQgeWiZfYJuR31vKw%3d&risl=&pid=ImgRaw&r=0',
  'naruto': 'https://tse1.mm.bing.net/th/id/OIP.S47sN1EnbmRlDgTD3coBiwHaDs?rs=1&pid=ImgDetMain&o=7&rm=3',
  'surfer': 'https://th.bing.com/th/id/OIP.ApR_wuPX0MsWpSWi73xMpgHaEK?o=7rm=3&rs=1&pid=ImgDetMain&o=7&rm=3',
  'surfer-gif': 'https://media.tenor.com/j1QA4Dpg4SIAAAAM/silver.gif',
  'surfer2': 'https://tse2.mm.bing.net/th/id/OIP.GYQW-TNWUuPL_tnhGv9D2QHaEK?rs=1&pid=ImgDetMain&o=7&rm=3',
  'naruto-gif': 'https://th.bing.com/th/id/R.e032973a23b3df2cfb20cf8c040545d0?rik=bjH3YH1rUQUXaA&riu=http%3a%2f%2forig02.deviantart.net%2f386f%2ff%2f2015%2f063%2f3%2f6%2fnaruto_attack_____by_hayabusasnake-d8kemfl.gif&ehk=oF%2fkeZtiHzVnJrcSvfsb6jE6i%2bA8vEQO1ypp3rsU6iE%3d&risl=&pid=ImgRaw&r=0',
  'onepiece': 'https://i.pinimg.com/originals/16/48/1e/16481e1d0b4a20444b94569128d34d30.jpg',
  'jjk': 'https://wallpapercave.com/wp/wp9745449.png',
  'roblox': 'https://wallpaperaccess.com/full/196936.jpg',
  'fortnite': 'https://wallpapercave.com/wp/wp5278223.jpg',
  'dbz': 'https://wallpapercave.com/wp/wp8939942.jpg',
  'tungtung': 'https://tse3.mm.bing.net/th/id/OIP.Gs7yG0bYERnVM_sCK4kIpAHaEK?rs=1&pid=ImgDetMain&o=7&rm=3'
};

// Clock
function updateClock() {
  const now = new Date();
  const timeString = now.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
  document.getElementById('clock').textContent = timeString;
}
setInterval(updateClock, 1000);
updateClock();

// Login System
function checkLogin() {
  const username = document.getElementById('username').value;
  const password = document.getElementById('password').value;
  const errorMsg = document.getElementById('errorMsg');
  
  if (username === '1' && password === 'blockmelol') {
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('introScreen').classList.add('active');
    
    setTimeout(() => {
      document.getElementById('introScreen').classList.remove('active');
      document.getElementById('mainSite').classList.add('active');
      loadGames();
    }, 3000);
  } else {
    errorMsg.style.display = 'block';
    setTimeout(() => {
      errorMsg.style.display = 'none';
    }, 3000);
  }
}

// Allow Enter key to login
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('password').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') checkLogin();
  });
  document.getElementById('username').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') document.getElementById('password').focus();
  });
});

// Games Data
let allGames = [];
let currentPage = 0;
const gamesPerPage = 5;
let focusedIndex = 0;

const ZONES = "https://cdn.jsdelivr.net/gh/gn-math/assets@main/zones.json";
const COVER = "https://cdn.jsdelivr.net/gh/gn-math/covers@main/";
const HTML_URL = "https://cdn.jsdelivr.net/gh/gn-math/html@main/";

const ROBLOX_IMAGE = "https://tse3.mm.bing.net/th/id/OIP.Suu0wkaP6duvpXY_gWJucgAAAA?rs=1&pid=ImgDetMain&o=7&rm=3";
const GTA_IMAGE = "https://tse2.mm.bing.net/th/id/OIP.T6kQS4BQ4CCT6jlXGtAuDgHaE7?rs=1&pid=ImgDetMain&o=7&rm=3";

function getRobloxHTML() {
  return `<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>roblox - Truffled</title>
<style>
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background: #000;
}
iframe {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    border: none;
}
#truffled-logo {
    position: fixed;
    bottom: 10px;
    right: 10px;
    width: 150px;
    height: 150px;
    cursor: pointer;
    z-index: 9999;
}
</style>
</head>
<body>
<iframe src="https://nevertraveling.thepresenttraveller.com/gamefile/nowgg/roblox.html?prefix=149" allowfullscreen></iframe>
<a href="https://nevertraveling.thepresenttraveller.com" target="_blank">
    <img id="truffled-logo" src="https://nevertraveling.thepresenttraveller.com/png/logo.png" alt="Logo">
</a>
</body>
</html>`;
}

function loadGames() {
  fetch(ZONES + "?t=" + Date.now())
    .then(r => {
      if (!r.ok) throw new Error("HTTP " + r.status);
      return r.json();
    })
    .then(data => {
      const apiGames = data.filter(g => !g.name.toLowerCase().includes("suggest") && !g.name.includes("[!]")).map(g => ({
        name: g.name,
        cover: g.cover ? g.cover.replace("{COVER_URL}", COVER).replace("{HTML_URL}", HTML_URL) : '',
        url: g.url,
        star: false
      }));
      
      allGames = [
        { name: "Roblox", cover: ROBLOX_IMAGE, html: getRobloxHTML(), star: true },
        { name: "GTA Vice City", cover: GTA_IMAGE, url: "https://sites.google.com/view/gtavicecityforclassroomspot/sdds?authuser=1", external: true, star: false },
        ...apiGames
      ];
      
      document.getElementById('totalGames').textContent = `Total Games: ${allGames.length}`;
      currentPage = 0;
      renderGames();
      renderPageIndicator();
    })
    .catch(err => {
      console.error("Error loading games:", err);
      allGames = [
        { name: "Roblox", cover: ROBLOX_IMAGE, html: getRobloxHTML(), star: true },
        { name: "GTA Vice City", cover: GTA_IMAGE, url: "https://sites.google.com/view/gtavicecityforclassroomspot/sdds?authuser=1", external: true, star: false }
      ];
      document.getElementById('totalGames').textContent = `Total Games: ${allGames.length}`;
      renderGames();
      renderPageIndicator();
    });
}

function renderGames() {
  const row = document.getElementById('gamesRow');
  row.innerHTML = '';
  
  const startIdx = currentPage * gamesPerPage;
  const endIdx = Math.min(startIdx + gamesPerPage, allGames.length);
  const pageGames = allGames.slice(startIdx, endIdx);
  
  pageGames.forEach((game, idx) => {
    const card = document.createElement("div");
    card.className = "game-card";
    card.dataset.index = startIdx + idx;
    
    if (game.cover) {
      const img = document.createElement("img");
      img.src = game.cover;
      img.alt = game.name;
      card.appendChild(img);
    }
    
    if (game.star) {
      const star = document.createElement("span");
      star.className = "star";
      star.textContent = "â˜…";
      card.appendChild(star);
    }
    
    const title = document.createElement("div");
    title.className = "title";
    title.textContent = game.name;
    card.appendChild(title);
    
    card.onclick = () => openGame(game);
    
    if (idx === focusedIndex) {
      card.classList.add('focused');
    }
    
    row.appendChild(card);
  });
  
  document.getElementById('prevBtn').disabled = currentPage === 0;
  document.getElementById('nextBtn').disabled = endIdx >= allGames.length;
  
  updatePageIndicator();
}

function renderPageIndicator() {
  const indicator = document.getElementById('pageIndicator');
  indicator.innerHTML = '';
  
  const totalPages = Math.ceil(allGames.length / gamesPerPage);
  for (let i = 0; i < totalPages; i++) {
    const dot = document.createElement("div");
    dot.className = "page-dot" + (i === currentPage ? " active" : "");
    dot.onclick = () => {
      currentPage = i;
      focusedIndex = 0;
      renderGames();
    };
    indicator.appendChild(dot);
  }
}

function updatePageIndicator() {
  const dots = document.querySelectorAll('.page-dot');
  dots.forEach((dot, idx) => {
    dot.classList.toggle('active', idx === currentPage);
  });
}

function nextPage() {
  const maxPage = Math.ceil(allGames.length / gamesPerPage) - 1;
  if (currentPage < maxPage) {
    currentPage++;
    focusedIndex = 0;
    renderGames();
    showKeyboardHint();
  }
}

function prevPage() {
  if (currentPage > 0) {
    currentPage--;
    focusedIndex = 0;
    renderGames();
    showKeyboardHint();
  }
}

// Keyboard Navigation
document.addEventListener('keydown', (e) => {
  if (!document.getElementById('mainSite').classList.contains('active')) return;
  
  const cards = document.querySelectorAll('.game-card');
  const cardsOnPage = cards.length;
  
  if (e.key === 'a' || e.key === 'A' || e.key === 'ArrowLeft') {
    e.preventDefault();
    if (focusedIndex > 0) {
      focusedIndex--;
      updateFocus();
    } else if (currentPage > 0) {
      prevPage();
      focusedIndex = gamesPerPage - 1;
      updateFocus();
    }
    showKeyboardHint();
  } else if (e.key === 'd' || e.key === 'D' || e.key === 'ArrowRight') {
    e.preventDefault();
    if (focusedIndex < cardsOnPage - 1 && focusedIndex < allGames.slice(currentPage * gamesPerPage).length - 1) {
      focusedIndex++;
      updateFocus();
    } else {
      const maxPage = Math.ceil(allGames.length / gamesPerPage) - 1;
      if (currentPage < maxPage) {
        nextPage();
        updateFocus();
      }
    }
    showKeyboardHint();
  } else if (e.key === 'Enter') {
    e.preventDefault();
    const startIdx = currentPage * gamesPerPage;
    if (allGames[startIdx + focusedIndex]) {
      openGame(allGames[startIdx + focusedIndex]);
    }
  }
});

function updateFocus() {
  const cards = document.querySelectorAll('.game-card');
  cards.forEach((card, idx) => {
    card.classList.toggle('focused', idx === focusedIndex);
  });
}

function showKeyboardHint() {
  const hint = document.getElementById('keyboardHint');
  hint.classList.add('show');
  setTimeout(() => {
    hint.classList.remove('show');
  }, 2000);
}

function openGame(game) {
  if (game.external) {
    window.open(game.url, '_blank');
  } else if (game.html) {
    const win = window.open("about:blank", "_blank");
    win.document.open();
    win.document.write(game.html);
    win.document.close();
  } else if (game.url) {
    fetch(game.url.replace("{HTML_URL}", HTML_URL))
      .then(r => r.text())
      .then(t => {
        const win = window.open("about:blank", "_blank");
        win.document.open();
        win.document.write(t);
        win.document.close();
      })
      .catch(err => {
        alert('Error loading game');
      });
  }
}

// Window Functions
function openWindow(url, title) {
  const win = document.getElementById('window');
  const frame = document.getElementById('frame');
  const titleSpan = document.getElementById('windowTitle');
  frame.src = url; 
  titleSpan.textContent = title; 
  win.classList.remove('hidden');
}

function closeWindow() {
  const win = document.getElementById('window');
  const frame = document.getElementById('frame');
  frame.src = ''; 
  win.classList.add('hidden');
}

// Settings
function openSettings() { 
  document.getElementById('settings').classList.remove('hidden'); 
}

function closeSettings() { 
  document.getElementById('settings').classList.add('hidden'); 
}

function setWallpaper(name) {
  const url = wallpapers[name];
  if (url) {
    document.body.style.backgroundImage = `url('${url}')`;
    document.body.style.backgroundSize = 'cover';
    document.body.style.backgroundPosition = 'center';
    document.body.style.backgroundRepeat = 'no-repeat';
    document.body.style.backgroundAttachment = 'fixed';
    localStorage.setItem('selectedWallpaper', name);
  }
}

function openAboutBlank() {
  const win = window.open('about:blank', '_blank');
  if (win) {
    win.document.write(`<!DOCTYPE html><html><head><title>about:blank</title><style>body{margin:0;padding:0;background:#000;overflow:hidden;}#cloak-frame{position:fixed;top:0;left:0;width:100vw;height:100vh;border:none;}</style></head><body><iframe id="cloak-frame" src="${window.location.href}"></iframe><script>setInterval(function(){window.history.replaceState({},'about:blank','about:blank');},100);<\/script></body></html>`);
    win.document.close();
  }
}

function setCloak() {
  const name = document.getElementById('cloakInput').value || 'about:blank';
  document.title = name;
  const link = document.querySelector("link[rel*='icon']") || document.createElement('link');
  link.type = 'image/x-icon'; 
  link.rel = 'shortcut icon'; 
  link.href = 'data:image/x-icon;base64,';
  document.getElementsByTagName('head')[0].appendChild(link);
  history.pushState({}, name, 'about:blank');
}

// Initialize wallpaper
document.addEventListener('DOMContentLoaded', () => {
  const savedWallpaper = localStorage.getItem('selectedWallpaper');
  if (savedWallpaper && wallpapers[savedWallpaper]) {
    setWallpaper(savedWallpaper);
  } else {
    setWallpaper('goku');
  }
});
</script>

</body>
</html>
